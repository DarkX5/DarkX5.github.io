{"flags":2,"id":9,"mSourceText":"\/* About the script \n *  Purpose : This script will allow you to set up a calendar widget replacement \n *  Author : LM13 \n *  Current Version : 1.3 \n *  Link :\n *\/\n\n\/\/config\nvar pattern = \"dd. MM. HH:mm\";\/\/format has to match http:\/\/developer.android.com\/reference\/java\/text\/SimpleDateFormat.html\nvar showEnd = true;\nvar patternEnd = \"HH:mm\"; \/\/used when entry ends on same day\nvar patternAllDay = \"dd. MM.\";\/\/used for all-day-entries \nvar showMax = 3;\nvar days = 90; \/\/how far to search from today (might be not exact)\nvar dayOffFix=false; \/\/when true adds one to all-day entries\n\/\/endconfig\n\n\nLL.bindClass(\"android.provider.CalendarContract\");\nLL.bindClass(\"java.util.Calendar\");\nLL.bindClass(\"android.content.ContentUris\");\nLL.bindClass(\"java.text.SimpleDateFormat\");\nLL.bindClass(\"android.app.AlertDialog\");\nLL.bindClass(\"android.widget.SimpleCursorAdapter\");\nLL.bindClass(\"android.R\");\nLL.bindClass(\"android.content.DialogInterface\");\nLL.bindClass(\"android.widget.AbsListView\");\nvar Calendars = CalendarContract.Calendars;\nvar Instances = CalendarContract.Instances;\n\nvar item=LL.getEvent().getItem();\nvar saved = item.getTag(\"calendar\");\nvar cx = LL.getContext();\nvar cr = cx.getContentResolver()\n\nif(saved==null){\nvar projection = [Calendars._ID,Calendars.NAME];\nvar calCursor = cr.query(Calendars.CONTENT_URI, projection, Calendars.VISIBLE + \" = 1\", null, Calendars._ID + \" ASC\");\nif (!calCursor.moveToFirst()){\nAndroiSD. makeNewToast(\"No Calendar found\").show();\ncalCursor.close();\nreturn;\n}\nvar adapter = new SimpleCursorAdapter(cx,R.layout.simple_list_item_multiple_choice,calCursor,[Calendars.NAME],[R.id.text1],0);\nvar dialog = new AlertDialog.Builder(cx)\n.setAdapter(adapter,null)\n.setPositiveButton(\"Confirm\", new DialogInterface.OnClickListener(){\nonClick:function(dialog,which){\nvar checked = dialog.getListView().getCheckedItemPositions();\nvar cals = [];\nfor(var i=0;i<checked.size();i++){\ncalCursor.moveToPosition(i);\nif(checked.get(checked.keyAt(i)))\ncals.push(calCursor.getLong(0));\n}\nitem.setTag(\"calendar\",JSON.stringify(cals));\nupdate(cals);\nAndroid.makeNewToast(\"Saved!\",true).show();\ncalCursor.close();\n}\n})\n.setNegativeButton(\"Cancel\",null)\n.setTitle(\"Select Calendar(s)\")\n.create();\ndialog.getListView().setChoiceMode(AbsListView.CHOICE_MODE_MULTIPLE);\ndialog.show();\n}\nelse update(JSON.parse(saved));\n\nfunction update(cals){\nif(cals.length<1)return;\nvar cal = Calendar.getInstance();\nvar begin = cal.getTimeInMillis();\ncal.add(Calendar.DAY_OF_YEAR,days);\nvar end = cal.getTimeInMillis();\nvar proj = [ Instances._ID, Instances.BEGIN, Instances.END,Instances.TITLE,Instances.ALL_DAY]; \nvar uriBuilder = Instances.CONTENT_URI.buildUpon();\nContentUris.appendId(uriBuilder,begin);\nContentUris.appendId(uriBuilder,end);\nvar s=\"('\";\nfor(var i=0;i<cals.length-1;i++){\ns+=cals[i]+\"','\";\n}\ns+=cals[cals.length-1]+\"')\";\n\nvar cursor = LL.getContext().getContentResolver().query(uriBuilder.build(), proj, Instances.CALENDAR_ID+\" IN \"+s,null,Instances.BEGIN+\" ASC\"); \nif(!cursor.moveToFirst()){\ncursor.close();\nreturn;\n}\nvar s=\"\";\nfor(var i=0;i<showMax;i++)\n{\nvar c=Calendar.getInstance();\nc.setTimeInMillis(cursor.getLong(1));\nvar c2=c.clone();\nc2.setTimeInMillis(cursor.getLong(2));\nvar format=new SimpleDateFormat(pattern);\nvar formatEnd=new SimpleDateFormat(patternEnd);\nvar formatAllDay=new SimpleDateFormat(patternAllDay);\nvar isAllDay=(cursor.getInt(4)==1);\ns+= cursor.getString(3);\nif(isAllDay)(dayOffFix?c:c2).add(Calendar.DAY_OF_YEAR,dayOffFix?1:-1);\nvar endsOnSame=(c.get(Calendar.DAY_OF_YEAR)==c2.get(Calendar.DAY_OF_YEAR));\nif(!isAllDay){\ns+=\" \"+format.format(c.getTime());\nif(showEnd){\nif(endsOnSame) s+=\" - \"+formatEnd.format(c2.getTime());\nelse s+=\" - \"+format.format(c2.getTime());\n}\n}\nelse{\ns+=\" \"+formatAllDay.format(c.getTime());\nif(!endsOnSame&&showEnd)s+=\" - \"+formatAllDay.format(c2.getTime());\n}\nif(cursor.moveToNext())s+=\"\\n\";\nelse break;\n}\nLL.getEvent().getItem().setLabel(s, true);\ncursor.close();\n}","name":"Minimal Calendar"}